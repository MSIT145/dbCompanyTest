@model dbCompanyTest.Models.TestStaff
@{
    ViewData["Title"] = "Index";
}
@{
    Layout = "_Back_Layout";
}

<h1>員工頁面</h1>

<h4>TestStaff</h4>
<h2 id="stf_info">@ViewBag.acc</h2>

<div id="Sheeplist_div">
    
</div>
<div >
    <table>
        <caption>待辦事項</caption>
        <thead>
            <tr>
                <th>交辦內容</th>
                <th>批示</th>
                <th>狀態</th>                
            </tr>
        </thead>
        <tbody id="ToDolist_tbody">

        </tbody>
    </table>
</div>




@section Scripts {

    <script>
        var split = $(`#stf_info`).text().indexOf(' ');
        var stf = $(`#stf_info`).text().substr(0, split)
        LoadSheeplist();
        LoadToDoList();

        

        function LoadSheeplist() {

            $('#Sheeplist_div').load("@Url.Content("~/Staff_Home/PartialSheeplist")")
            $.getScript("@Url.Content("~/js/LoadSheeplist.js")");

           
        }

        function LoadToDoList() {
            $.ajax({
                url: `@Url.Content("~/Staff_Home/LoadToDoList")`,
                type: "GET",
                data: { "stf": stf },
                dataType: "json"
            })
                .done(data => {
                    let docFrag = $(document.createDocumentFragment());
                    $.each(data, function (i, i_val) {
                        const eleT = $(`<tr></tr>`).append(`<td>${i_val.交辦內容}</td>
                                        <td>${i_val.批示}</td>
                                        <td>${i_val.狀態}</td>`);
                        docFrag.append(eleT);
                    });
                    $("#ToDolist_tbody").html(docFrag);

                })
        }

    </script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

}



@{
    ViewData["Title"] = "RePassword";
}

<h1>重設密碼</h1>
<input type="hidden" value="@ViewBag.Email" id="account" />
<input type="text" id="newPassword" />
<p id="passwordformat"></p>
<input type="text" id="dblnewPassword" />
<p id="check"></p>
<botton id="ok" class="btn btn-primary">確認</botton>

@section Scripts{
    <script>
        let click = [false,false];
        let newPassword = $(`#newPassword`);
        let dblnewPassword = $(`#dblnewPassword`);
        let check = $(`#check`);
        $(`#ok`).on(`click`,function(){
            if (click[0] && click[1])
            $.post("@Url.Content("~/Login/ResetPassword")", { "Email": $(`#account`).val(), "Password":newPassword.val()},function(data){
                window.location.assign("https://localhost:7100/Home/Index");
            })
            else{
                alert("請輸入正確資料");
            }
        });
        dblnewPassword.on('blur', function () {
            if(dblnewPassword.val()===newPassword.val()){
                check.text("通過");
                check.css("color","green");
                click[1] = true;
            }
            else{
                check.text("與密碼不相符");
                check.css("color","red");
                click[1] = false;
            }
        });

        newPassword.on(`blur`,function(){
            let checkInput = $(this);
            let CPchar, a = [false, false, false, false];
            let special = "!#$%^&*";
            if (checkInput.val().length > 6) {
                a[3] = true;
            }
            for (let i = 0; i < checkInput.val().length; i++) {
                CPchar = checkInput.val().charAt(i).toUpperCase();
                if (CPchar >= "A" && CPchar <= "Z") {
                    a[0] = true;
                }
                if (CPchar >= "0" && CPchar <= "9") {
                    a[1] = true;
                }
                for (let j = 0; j < special.length; j++) {
                    specialchar = special.charAt(j);
                    if (CPchar == specialchar) {
                        a[2] = true;
                    }
                }
            }
            if (a[0] && a[1] && a[2] && a[3]) {
                $(`#passwordformat`).text("OK");
                $(`#passwordformat`).css("color","green");
                click[0] = true;
            }
            else {
                $(`#passwordformat`).text("密碼要包含英、數字、特殊符號(!#$%^&*)且長度需大於6");
                $(`#passwordformat`).css("color","red");
                click[0] = false;
            }
        });
    </script>
}
